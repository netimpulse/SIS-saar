{{ 'section-custom-header.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign logo_width = section.settings.logo_width | prepend: 'width:'
-%}

{%- style -%}
  .header-wrapper-{{ section.id }} {
    --menu-font: {{ section.settings.menu_font.family }}, {{ section.settings.menu_font.fallback_families }};
    --menu-font-weight: {% if section.settings.menu_font_bold %}bold{% else %}normal{% endif %};
    --menu-active-color: {{ section.settings.active_color }};
    --button-text: {{ section.settings.button_text_color }};
    --button-background: {{ section.settings.button_bg_color }};
  }

  .header-wrapper-{{ section.id }} .custom-header__logo-image {
    max-width: {{ section.settings.logo_width }}px;
  }
{%- endstyle -%}

<div class="header-wrapper-{{ section.id }}">
  <header class="custom-header page-width">
    
    <div class="custom-header__left">
      {%- if section.settings.logo != blank -%}
        <a href="{{ routes.root_url }}" class="custom-header__logo-link">
          {{ section.settings.logo | image_url: width: 500 | image_tag:
            class: 'custom-header__logo-image',
            alt: section.settings.logo.alt | default: shop.name,
            width: section.settings.logo_width }}
        </a>
      {%- else -%}
        <a href="{{ routes.root_url }}" class="custom-header__shop-name h2">
          {{ shop.name }}
        </a>
      {%- endif -%}
    </div>

    <div class="custom-header__center">
      <nav class="custom-header__nav" role="navigation">
        <ul class="custom-header__menu-list">
          {%- for link in section.settings.menu.links -%}
            <li>
              <a 
                href="{{ link.url }}" 
                class="custom-header__menu-link {% if link.active %}active{% endif %}"
              >
                <span>{{ link.title }}</span>
              </a>
            </li>
          {%- endfor -%}
        </ul>
      </nav>
    </div>

    <div class="custom-header__right">
       {%- if section.settings.button_text != blank and section.settings.button_link != blank -%}
        <a href="{{ section.settings.button_link }}" class="custom-header__button">
          {{ section.settings.button_text }}
        </a>
      {%- endif -%}
      <button type="button" class="custom-header__mobile-toggle" aria-controls="mobile-menu-drawer" aria-expanded="false">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-menu-2" width="28" height="28" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 6l16 0" /><path d="M4 12l16 0" /><path d="M4 18l16 0" /></svg>
        <span class="visually-hidden">Menü</span>
      </button>
    </div>
  </header>

  <div class="mobile-menu__drawer" id="mobile-menu-drawer" role="dialog" aria-modal="true">
    <div class="mobile-menu__header">
        <button type="button" class="mobile-menu__close-button">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-x" width="28" height="28" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6l-12 12" /><path d="M6 6l12 12" /></svg>
            <span class="visually-hidden">Schließen</span>
        </button>
    </div>
    <div class="mobile-menu__content">
      <ul class="mobile-menu__list">
        {%- for link in section.settings.menu.links -%}
          <li>
            <a href="{{ link.url }}" class="mobile-menu__link {% if link.active %}active{% endif %}">
              {{ link.title }}
            </a>
          </li>
        {%- endfor -%}
      </ul>
      {%- if section.settings.button_text != blank and section.settings.button_link != blank -%}
        <a href="{{ section.settings.button_link }}" class="mobile-menu__button">
          {{ section.settings.button_text }}
        </a>
      {%- endif -%}
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const mobileToggle = document.querySelector('.custom-header__mobile-toggle');
    const closeButton = document.querySelector('.mobile-menu__close-button');
    const drawer = document.getElementById('mobile-menu-drawer');
    const headerWrapper = document.querySelector('.header-wrapper-{{ section.id }}');

    const openMenu = () => {
      drawer.classList.add('is-open');
      headerWrapper.classList.add('drawer-is-open');
      document.body.style.overflow = 'hidden';
      mobileToggle.setAttribute('aria-expanded', 'true');
    };

    const closeMenu = () => {
      drawer.classList.remove('is-open');
      headerWrapper.classList.remove('drawer-is-open');
      document.body.style.overflow = '';
      mobileToggle.setAttribute('aria-expanded', 'false');
    };

    mobileToggle.addEventListener('click', openMenu);
    closeButton.addEventListener('click', closeMenu);
    
    // Optional: Close drawer if escape key is pressed
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && drawer.classList.contains('is-open')) {
        closeMenu();
      }
    });
  });
</script>

{% schema %}
{
  "name": "Custom Header SIS",
  "class": "section-header",
  "settings": [
    {
      "type": "header",
      "content": "Logo Einstellungen"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo Bild"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 50,
      "max": 250,
      "step": 5,
      "unit": "px",
      "label": "Logo Breite (Desktop)",
      "default": 140
    },
    {
      "type": "header",
      "content": "Navigation"
    },
    {
      "type": "link_list",
      "id": "menu",
      "default": "main-menu",
      "label": "Menü auswählen"
    },
    {
      "type": "font_picker",
      "id": "menu_font",
      "label": "Schriftart für Menü",
      "default": "sans-serif"
    },
    {
      "type": "checkbox",
      "id": "menu_font_bold",
      "label": "Menü-Schrift fett darstellen",
      "default": false
    },
    {
      "type": "color",
      "id": "active_color",
      "label": "Farbe für aktiven/Hover-Link",
      "default": "#39B54A"
    },
    {
      "type": "header",
      "content": "Kontakt Button"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "Kontakt"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button Link"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button Textfarbe",
      "default": "#FFFFFF"
    },
    {
      "type": "color",
      "id": "button_bg_color",
      "label": "Button Hintergrundfarbe",
      "default": "#39B54A"
    }
  ]
}
{% endschema %}
