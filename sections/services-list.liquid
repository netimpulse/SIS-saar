{% comment %}
Services-Seite: alle Leistungen als Blöcke.
– Suchfeld oben auf der Seite (lokal)
– JSON + datalist für Autocomplete & Header-Suche
{% endcomment %}

<section class="service-wrapper">

  <!-- Lokales Suchfeld -->
  <div class="service-search-bar">
    <input id="service-search-local"
           class="service-search-input"
           type="search"
           placeholder="Leistung suchen …"
           list="services-datalist">
  </div>

  <!-- datalist für Autocomplete -->
  <datalist id="services-datalist">
    {%- for block in section.blocks -%}
      <option value="{{ block.settings.heading | escape }}"></option>
    {%- endfor -%}
  </datalist>

  <!-- JSON für Header-Suche -->
  <script id="services-json" type="application/json">
    [
      {%- for block in section.blocks -%}
        {
          "title": {{ block.settings.heading | json }},
          "anchor": {{ block.settings.anchor | default: block.settings.heading | handleize | json }}
        }{% unless forloop.last %},{% endunless %}
      {%- endfor -%}
    ]
  </script>

  <!-- Leistungs-Blöcke -->
  {%- for block in section.blocks -%}
    {%- assign a = block.settings.anchor | default: block.settings.heading | handleize -%}

    <article id="{{ a }}"
             class="service-block"
             {{ block.shopify_attributes }}>

      {% if block.settings.image != blank %}
        <div class="service-image">
          {{ block.settings.image
             | image_url: width: 1200
             | image_tag: loading: 'lazy' }}
        </div>
      {% endif %}

      <div class="service-content">
        <h2 class="service-heading"
            style="
              color: {{ block.settings.heading_color }};
              font-size: {{ block.settings.heading_size }}px;
              {% if block.settings.heading_weight == 'bold' %}font-weight:700;{% endif %}
            ">
          {{ block.settings.heading }}
        </h2>

        <div class="service-text"
             style="color: {{ block.settings.body_color }};
                    font-size: {{ block.settings.body_size }}px;">
          {{ block.settings.body }}
        </div>
      </div>
    </article>
  {%- endfor -%}
</section>

<!-- JS: Scroll-Logik im lokalen Suchfeld -->
<script>
(() => {
  const input = document.getElementById('service-search-local');
  if (!input) return;

  const services = JSON.parse(
    document.getElementById('services-json').textContent
  );

  input.addEventListener('change', e => {
    const term  = e.target.value.toLowerCase();
    const hit   = services.find(s => s.title.toLowerCase() === term);
    if (!hit) return;

    document.getElementById(hit.anchor)
            ?.scrollIntoView({ behavior: 'smooth', block: 'start' });
  });
})();
</script>

{% schema %}
{
  "name": "Services-Liste",
  "tag": "section",
  "class": "services-list",
  "max_blocks": 100,
  "blocks": [
    {
      "type": "service",
      "name": "Leistung",
      "settings": [
        { "id": "heading",        "type": "text",       "label": "Überschrift",    "default": "Neue Leistung" },
        { "id": "body",           "type": "richtext",   "label": "Beschreibung" },
        { "id": "image",          "type": "image_picker","label": "Bild" },

        { "type": "header",       "content": "Darstellung" },

        { "id": "anchor",         "type": "text",       "label": "Anchor-ID (optional)",
          "info": "Leer lassen, um sie automatisch aus der Überschrift zu erzeugen." },

        { "id": "heading_color",  "type": "color",      "label": "Farbe Überschrift", "default": "#1a1a1a" },
        { "id": "heading_size",   "type": "range",      "label": "Größe Überschrift", "min":18,"max":60,"step":1,"default":28 },
        { "id": "heading_weight", "type": "select",     "label": "Schriftgewicht Überschrift",
          "options":[{"value":"normal","label":"Normal"},{"value":"bold","label":"Fett"}],"default":"bold" },

        { "id": "body_color",     "type": "color",      "label": "Farbe Text",        "default": "#666666" },
        { "id": "body_size",      "type": "range",      "label": "Größe Text",        "min":12,"max":30,"step":1,"default":18 }
      ]
    }
  ],
  "presets":[{ "name":"Services-Liste"}]
}
{% endschema %}
